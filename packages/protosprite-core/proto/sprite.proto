syntax = "proto3";

package protosprite;

import "google/protobuf/wrappers.proto";

// 2D coordinates.
message Position {
  int32 x = 1;
  int32 y = 2;
};

message Size {
  int32 width = 1;
  int32 height = 2;
}

// This message represents one frame of the sprite.
message Frame {
  int32 index = 1;

  // Since frames can have multiple layers, we embed all non-empty layers here.
  message FrameLayer {
    int32 layer_index = 1;
    Size size = 2;
    Position sheet_position = 3;
    Position sprite_position = 4;
  }

  repeated FrameLayer layers = 2;
  float duration = 3;
};

// Sprites can have named layers, and these layers can be nested.
message Layer {
  string name = 1;
  bool is_group = 2;
  google.protobuf.Int32Value parent_index = 3;
  google.protobuf.FloatValue opacity = 4;
};

// Sprites can have any number of overlapping animations.
message Animation {
  string name = 1;
  int32 index_start = 2;
  int32 index_end = 3;
};

// Sprites can embed their sprite sheets.
message EmbeddedSpriteSheet {
  enum Encoding {
    ENCODING_UNKNOWN = 0;
    ENCODING_PNG = 1;
  };

  Encoding encoding = 1;
  bytes data = 2;
};

// Sprites can reference external sprite sheets.
message ExternalSpriteSheet {
  oneof source {
    string url = 2;
    string file_name = 3;
  }
};

// Sprite message.
message Sprite {
  string name = 1;

  oneof pixel_source {
    bool embedded_in_parent_sheet = 2;
    EmbeddedSpriteSheet embedded_sheet = 3;
    ExternalSpriteSheet external_sheet = 4;
  }

  repeated Frame frames = 5;
  repeated Layer layers = 6;
  repeated Animation animations = 7;
  Size size = 8;
};

// Sprite sheet message.
message SpriteSheet {
  repeated Sprite sprites = 1;
  oneof pixel_source {
    EmbeddedSpriteSheet embedded_sheet = 2;
    ExternalSpriteSheet external_sheet = 3;
  }
}
